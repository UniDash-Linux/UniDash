name: Branch Policy

on:
  pull_request:
    branches: [main]

jobs:
  check-branch:
    name: Check source branch
    runs-on: ubuntu-latest
    steps:
      - name: Verify source branch
        run: |
          SOURCE_BRANCH="${{ github.head_ref }}"
          echo "Source branch: $SOURCE_BRANCH"

          # Allow PRs from develop or fix/* branches only
          if [[ "$SOURCE_BRANCH" == "develop" ]] || [[ "$SOURCE_BRANCH" == fix/* ]]; then
            echo "✓ PR from '$SOURCE_BRANCH' to main is allowed"
          else
            echo "✗ PR from '$SOURCE_BRANCH' to main is NOT allowed"
            echo ""
            echo "Only the following branches can merge to main:"
            echo "  - develop"
            echo "  - fix/*"
            echo ""
            echo "Please merge your changes to develop first."
            exit 1
          fi
